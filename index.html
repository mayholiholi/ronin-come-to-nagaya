<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>é•·å±‹ã«æ¥ã¦ãã‚Œï¼ - Rise of the Ronin å¥½ç‰©æ¤œç´¢</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ */
            --bg: #f8f8f8;
            --bg1: #ffffff;
            --bg2: #f4f4f5;
            --bg3: #ebebec;
            --bg4: #e0e0e2;
            --bg-hover: rgba(0,0,0,0.03);
            --bg-press: rgba(0,0,0,0.06);
            --border: rgba(0,0,0,0.08);
            --border-hover: rgba(0,0,0,0.16);
            --color: #1a1a1a;
            --color2: #333333;
            --color3: #666666;
            --color4: #999999;
            --accent: #6e56cf;
            --accent2: #5746a8;
            --accent-bg: rgba(110,86,207,0.09);
            --accent-bg-hover: rgba(110,86,207,0.15);
            --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.08);
            --radius-sm: 10px;
            --radius-md: 16px;
            --radius-lg: 20px;
            --radius-full: 999px;

            /* æ´¾é–¥ */
            --f-tobaku: #cd2b31;
            --f-tobaku-bg: rgba(205,43,49,0.08);
            --f-sabaku: #3358c4;
            --f-sabaku-bg: rgba(51,88,196,0.08);
            --f-kaigai: #278c5a;
            --f-kaigai-bg: rgba(39,140,90,0.08);
            --f-sonota: #6e56cf;
            --f-sonota-bg: rgba(110,86,207,0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: "Inter", "Noto Sans JP", -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--color2);
            min-height: 100vh;
            min-height: 100dvh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* === ãƒ˜ãƒƒãƒ€ãƒ¼ === */
        header {
            max-width: 600px;
            margin: 0 auto;
            padding: 40px max(16px, env(safe-area-inset-left)) 24px;
            text-align: center;
        }
        .hero-title {
            font-size: 1.75em;
            font-weight: 700;
            color: var(--color);
            letter-spacing: -0.02em;
            line-height: 1.2;
        }
        .hero-sub {
            font-size: 0.8125em;
            font-weight: 500;
            color: var(--color4);
            margin-top: 6px;
        }
        .hero-link {
            color: var(--accent2);
            text-decoration: none;
            font-weight: 600;
            border-bottom: 1px dashed var(--accent);
            transition: border-color 0.15s;
        }
        .hero-link:hover {
            border-bottom-style: solid;
        }
        .hero-notice {
            margin-top: 16px;
            padding: 10px 14px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.6875em;
            color: var(--color4);
            line-height: 1.6;
            text-align: left;
        }

        /* === ãƒ¡ã‚¤ãƒ³ === */
        main {
            max-width: 600px;
            margin: 0 auto;
            padding: 12px max(16px, env(safe-area-inset-left)) 100px;
        }

        /* === ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆã‚¿ãƒ–ï¼‰ === */
        .segment-group {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: var(--bg1);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            overflow-x: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .segment-group::-webkit-scrollbar { display: none; }

        .segment-btn {
            flex: 1;
            min-width: 0;
            height: 36px;
            padding: 0 12px;
            border: none;
            border-radius: calc(var(--radius-md) - 4px);
            background: transparent;
            color: var(--color3);
            font-family: inherit;
            font-size: 0.8125em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25,0.1,0.25,1);
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .segment-btn:hover {
            color: var(--color2);
            background: var(--bg-hover);
        }
        .segment-btn:active {
            transform: scale(0.97);
            background: var(--bg-press);
        }
        .segment-btn.active {
            background: var(--bg3);
            color: var(--color);
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .seg-count {
            font-size: 0.85em;
            opacity: 0.5;
        }

        /* === ã‚«ãƒ¼ãƒ‰ãƒ‘ãƒãƒ« === */
        .panel-wrap { margin-top: 12px; }
        .panel { display: none; }
        .panel.active { display: block; }

        .card {
            background: var(--bg1);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 16px;
            box-shadow: var(--shadow);
        }
        .card-title {
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--color4);
            margin-bottom: 12px;
        }

        /* === ãƒãƒƒãƒ—ï¼ˆã‚­ãƒ£ãƒ©é¸æŠï¼‰ === */
        .chip-wrap {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .chip { position: relative; }
        .chip input {
            position: absolute;
            opacity: 0;
            width: 0; height: 0;
        }
        .chip-label {
            display: flex;
            align-items: center;
            gap: 6px;
            height: 38px;
            padding: 0 14px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg2);
            color: var(--color3);
            font-size: 0.8125em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.25,0.1,0.25,1);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .chip-label:hover {
            border-color: var(--border-hover);
            color: var(--color2);
            background: var(--bg3);
        }
        .chip-label:active {
            transform: scale(0.96);
        }
        .chip input:checked + .chip-label {
            background: var(--accent-bg);
            border-color: var(--accent);
            color: var(--accent2);
            font-weight: 600;
        }
        .chip input:checked + .chip-label::before {
            content: 'âœ“';
            font-size: 0.8em;
            margin-right: 2px;
        }

        /* === ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡Œ === */
        .actions {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
        }
        .btn-outline {
            height: 36px;
            padding: 0 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg1);
            color: var(--color3);
            font-family: inherit;
            font-size: 0.8125em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-outline:hover {
            border-color: var(--border-hover);
            color: var(--color2);
            background: var(--bg2);
        }
        .btn-outline:active {
            transform: scale(0.97);
            background: var(--bg3);
        }
        .counter {
            font-size: 0.8125em;
            color: var(--color4);
        }
        .counter b {
            color: var(--accent2);
            font-weight: 600;
        }

        /* === å¥½ç‰©ã‚»ã‚¯ã‚·ãƒ§ãƒ³ === */
        .section-label {
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--color4);
            margin: 24px 0 12px;
        }

        .fav-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .fav-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            background: var(--bg1);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow);
            opacity: 0;
            transform: translateY(8px);
            animation: fadeIn 0.3s cubic-bezier(0.25,0.1,0.25,1) forwards;
            transition: all 0.15s;
            -webkit-tap-highlight-color: transparent;
        }
        .fav-card:hover {
            background: var(--bg2);
            border-color: var(--border-hover);
        }
        .fav-card:active {
            transform: scale(0.99);
        }

        .fav-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
        }
        .fav-card.multiple .fav-icon {
            background: var(--accent-bg);
        }
        .fav-card.single .fav-icon {
            background: var(--bg3);
        }

        .fav-body { flex: 1; min-width: 0; }
        .fav-name {
            font-size: 0.875em;
            font-weight: 600;
            color: var(--color);
            line-height: 1.3;
        }
        .fav-chars {
            font-size: 0.75em;
            color: var(--color4);
            line-height: 1.5;
            margin-top: 2px;
        }

        .fav-badge {
            flex-shrink: 0;
            min-width: 28px;
            height: 28px;
            padding: 0 8px;
            border-radius: var(--radius-full);
            font-size: 0.75em;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .fav-card.multiple .fav-badge {
            background: var(--accent);
            color: #fff;
        }
        .fav-card.single .fav-badge {
            background: var(--bg3);
            color: var(--color4);
        }

        .empty-msg {
            text-align: center;
            color: var(--color4);
            padding: 40px 20px;
            font-size: 0.875em;
            line-height: 1.7;
            background: var(--bg1);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
        }
        .empty-icon {
            font-size: 2em;
            margin-bottom: 12px;
            opacity: 0.4;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === ãƒ•ãƒƒã‚¿ãƒ¼ === */
        footer {
            max-width: 600px;
            margin: 0 auto;
            padding: 24px max(16px, env(safe-area-inset-left));
            padding-bottom: max(32px, env(safe-area-inset-bottom));
            text-align: center;
            border-top: 1px solid var(--border);
        }
        footer a {
            color: var(--accent2);
            text-decoration: none;
            font-weight: 500;
        }
        footer a:hover { text-decoration: underline; }
        .footer-links {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        .footer-links a { font-size: 0.8125em; }
        .footer-dot { color: var(--color4); font-size: 0.75em; }

        /* === ã‚¹ãƒãƒ›æœ€é©åŒ– === */
        @supports (padding: max(0px)) {
            header { padding-left: max(16px, env(safe-area-inset-left)); padding-right: max(16px, env(safe-area-inset-right)); }
            main { padding-left: max(16px, env(safe-area-inset-left)); padding-right: max(16px, env(safe-area-inset-right)); }
        }
    </style>
</head>
<body>
    <header>
        <h1 class="hero-title">é•·å±‹ã«æ¥ã¦ãã‚Œï¼</h1>
        <p class="hero-sub"><a href="https://teamninja-studio.com/ronin/jp/" target="_blank" class="hero-link">Rise of the Ronin</a> å¥½ç‰©æ¤œç´¢ãƒ„ãƒ¼ãƒ«</p>
        <div class="hero-notice">
            ã“ã®Webã‚¢ãƒ—ãƒªã¯ãƒ•ã‚¡ãƒ³ã«ã‚ˆã‚‹éå…¬å¼ã®ä½œæˆç‰©ã§ã™ã€‚ã‚²ãƒ¼ãƒ å†…ã§ç¢ºèªå¯èƒ½ãªæƒ…å ±ã‚’ã‚‚ã¨ã«è¤‡æ•°ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å¥½ç‰©ã‚’è¦‹ã‚„ã™ããƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã€ç‹™ã£ãŸã‚­ãƒ£ãƒ©ã®é•·å±‹ã¸ã®æ¥è¨ªç‡ã‚¢ãƒƒãƒ—ã®æ‰‹åŠ©ã‘ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚æƒ…å ±ã®æ­£ç¢ºæ€§ã«ã¤ã„ã¦ã¯ä¿è¨¼ã„ãŸã—ã‹ã­ã¾ã™ã€‚
        </div>
    </header>

    <main>
        <div class="segment-group" id="segmentGroup"></div>
        <div class="panel-wrap" id="panelWrap"></div>

        <div class="actions">
            <button class="btn-outline" onclick="clearSelection()">é¸æŠã‚’è§£é™¤</button>
            <span class="counter" id="counter"></span>
        </div>

        <div class="section-label">å¥½ç‰©ãƒªã‚¹ãƒˆ</div>
        <ul class="fav-list" id="favList">
            <li class="empty-msg">
                <div class="empty-icon">ğŸ¯</div>
                ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠã—ã¦<br>å¥½ç‰©ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†
            </li>
        </ul>
    </main>

    <footer>
        <div class="footer-links">
            <a href="https://mayholiholi.github.io" target="_blank">ä»–ã®ãƒ„ãƒ¼ãƒ«</a>
        </div>
    </footer>

    <script>
        const GIFT_EMOJIS = {
            "è»½ã‚„ã‹ãªé…’": "ğŸº", "æ´‹è“å­": "ğŸ°", "æ´‹è£…": "ğŸ‘—",
            "å’Œæ­Œ": "ğŸ“œ", "èŠ³é†‡ãªé…’": "ğŸ¶", "ç¾è¡“å“": "ğŸ–¼ï¸",
            "å¼·çƒˆãªå‘³ã®é…’": "ğŸ¥ƒ", "éª¨è‘£": "ğŸº", "å„’æ•™ã‚„æ¼¢è©©": "ğŸ“š",
            "è˜­å­¦ã‚„è‹±èª": "ğŸ“–", "æµ·æ´‹å†’é™º": "ğŸš¢", "æµè¡Œã‚Šã‚‚ã®ã‚„åŒ–ç²§": "ğŸ’„",
            "é›éŒ¬": "ğŸ‹ï¸", "è²´é‡å“": "ğŸ’", "ãŠé¦™ã‚„æ¤ç‰©": "ğŸŒ¿",
            "çŒ«ã‚„å­ä¾›": "ğŸ¾", "å²æ›¸": "ğŸ“–", "ç…™è‰": "ğŸš¬",
            "å’Œè“å­": "ğŸ¡", "å†™çœŸã‚„æ—¥æœ¬ã®é¢¨ç‰©": "ğŸ“·", "ç§‘å­¦": "ğŸ”¬",
            "å®é£¾å“": "ğŸ’", "å›²ç¢": "â™Ÿ"
        };

        const FACTIONS = {
            "å€’å¹•": { c: "var(--f-tobaku)", bg: "var(--f-tobaku-bg)" },
            "ä½å¹•": { c: "var(--f-sabaku)", bg: "var(--f-sabaku-bg)" },
            "æµ·å¤–": { c: "var(--f-kaigai)", bg: "var(--f-kaigai-bg)" },
            "ãã®ä»–": { c: "var(--f-sonota)", bg: "var(--f-sonota-bg)" },
        };
        const DEF_F = { c: "var(--f-sonota)", bg: "var(--f-sonota-bg)" };
        function getF(f) { return FACTIONS[f] || DEF_F; }

        function esc(t) {
            const d = document.createElement('div');
            d.textContent = t;
            return d.innerHTML;
        }

        let chars = [];

        async function loadData() {
            try {
                const res = await fetch('csv/date.csv');
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const text = await res.text();
                const lines = text.trim().split('\n');
                for (let i = 1; i < lines.length; i++) {
                    const m = lines[i].match(/^([^,]+),([^,]+),(.+)$/);
                    if (!m) continue;
                    chars.push({ name: m[1].trim(), faction: m[2].trim(), gifts: m[3].replace(/^"|"$/g,'').trim() });
                }
                buildUI();
            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                document.getElementById('panelWrap').innerHTML =
                    '<div class="empty-msg"><div class="empty-icon">âš ï¸</div>ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</div>';
            }
        }

        function buildUI() {
            const factions = [...new Set(chars.map(c => c.faction))];
            const seg = document.getElementById('segmentGroup');
            const pw = document.getElementById('panelWrap');

            factions.forEach((f, i) => {
                const st = getF(f);
                const cnt = chars.filter(c => c.faction === f).length;

                const btn = document.createElement('button');
                btn.className = `segment-btn${i===0?' active':''}`;
                btn.dataset.panel = `p-${i}`;
                btn.dataset.faction = f;
                btn.innerHTML = `${esc(f)} <span class="seg-count">${cnt}</span>`;
                if (i===0) { btn.style.borderColor = st.c; }
                btn.addEventListener('click', () => switchPanel(btn));
                seg.appendChild(btn);

                const panel = document.createElement('div');
                panel.className = `panel${i===0?' active':''}`;
                panel.id = `p-${i}`;
                panel.innerHTML = `<div class="card"><div class="card-title">${esc(f)} â€” ${cnt}äºº</div><div class="chip-wrap" id="cw-${i}"></div></div>`;
                pw.appendChild(panel);

                const cw = document.getElementById(`cw-${i}`);
                chars.filter(c => c.faction === f).forEach(c => {
                    const chip = document.createElement('div');
                    chip.className = 'chip';
                    const s = esc(c.name);
                    chip.innerHTML = `<input type="checkbox" id="c-${s}" name="characters" value="${s}" onchange="updateFav()"><label class="chip-label" for="c-${s}">${s}</label>`;
                    cw.appendChild(chip);
                });
            });
        }

        function switchPanel(btn) {
            document.querySelectorAll('.segment-btn').forEach(b => {
                b.classList.remove('active');
                b.style.borderColor = '';
            });
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            const st = getF(btn.dataset.faction);
            btn.style.borderColor = st.c;
            document.getElementById(btn.dataset.panel).classList.add('active');
        }

        function updateFav() {
            const sel = Array.from(document.querySelectorAll('input[name="characters"]:checked')).map(cb => cb.value);
            const list = document.getElementById('favList');
            const ctr = document.getElementById('counter');
            list.innerHTML = '';

            if (!sel.length) {
                ctr.innerHTML = '';
                list.innerHTML = '<li class="empty-msg"><div class="empty-icon">ğŸ¯</div>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠã—ã¦<br>å¥½ç‰©ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†</li>';
                return;
            }
            ctr.innerHTML = `<b>${sel.length}</b>äººã‚’é¸æŠä¸­`;

            const sd = chars.filter(c => sel.includes(c.name));
            const fav = {};
            sd.forEach(c => {
                c.gifts.split(',').map(s => s.trim()).forEach(item => {
                    /* è²´é‡å“ã¯å…¨ã‚­ãƒ£ãƒ©å…±é€šã®ãŸã‚é™¤å¤– */
                    if (item.includes('è²´é‡å“')) return;
                    if (!fav[item]) fav[item] = [];
                    fav[item].push(c.name);
                });
            });

            Object.entries(fav).sort((a,b) => b[1].length - a[1].length).forEach(([item, ppl], idx) => {
                let emoji = '';
                for (const [t,e] of Object.entries(GIFT_EMOJIS)) {
                    if (item.includes(t)) { emoji = e; break; }
                }
                const mult = ppl.length > 1;
                const li = document.createElement('li');
                li.className = `fav-card ${mult?'multiple':'single'}`;
                li.style.animationDelay = `${Math.min(idx*0.04,0.6)}s`;
                li.innerHTML = `
                    <div class="fav-icon">${emoji||'ğŸ'}</div>
                    <div class="fav-body">
                        <div class="fav-name">${esc(item)}</div>
                        <div class="fav-chars">${ppl.map(esc).join('ã€')} â€” ${ppl.length}äººãŒå¥½ã</div>
                    </div>
                    <div class="fav-badge">${ppl.length}</div>
                `;
                list.appendChild(li);
            });
        }

        function clearSelection() {
            document.querySelectorAll('input[name="characters"]:checked').forEach(cb => cb.checked = false);
            document.getElementById('favList').innerHTML = '<li class="empty-msg"><div class="empty-icon">ğŸ¯</div>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠã—ã¦<br>å¥½ç‰©ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†</li>';
            document.getElementById('counter').innerHTML = '';
        }

        loadData();
    </script>
</body>
</html>
